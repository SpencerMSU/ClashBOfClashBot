Текущая система базы данных построена на MongoDB и использует следующие коллекции и операции:

1. Пользователи и профили
   - Коллекция users хранит связь между Telegram ID и основным player_tag.
   - Коллекция user_profiles поддерживает несколько профилей на пользователя с именем, флагом основного профиля и датой создания.
   - Реализованы операции поиска/сохранения/удаления пользователя, получения списка пользователей, работы с профилями и выбора
     основного профиля.

2. Подписки и уведомления
   - Коллекция subscriptions хранит активные и истекшие подписки, даты действия, платежную информацию и тип подписки.
   - Коллекция notifications фиксирует пользователей с включёнными уведомлениями.
   - Поддерживаются операции продления, деактивации, получения подписки, списка подписчиков и переключения уведомлений.

3. Привязанные кланы
   - Коллекция linked_clans содержит кланы, закреплённые за пользователями, с названием, тэгом и номером слота.
   - Методы позволяют сохранять, получать и удалять кланы, а также определять лимиты слотов на основе уровня подписки.

4. Войны и атаки
   - Коллекция wars хранит итоговые данные по войнам, включая результат, звёзды, разрушения, CWL-флаг и список атак.
   - Каждая война содержит массив атак с информацией об атакующем, защитнике, звёздах, разрушении и признаке нарушения правил.
   - Реализованы операции сохранения, проверки существования, получения списков войн и детальной статистики, включая анализ CWL.

5. Запросы сканирования и донаты
   - Коллекция war_scan_requests фиксирует запросы на сканирование (тип, статус, дата, количество добавленных войн).
   - Коллекция player_stats_snapshots хранит снимки донатов игроков для расчёта сезонной статистики.
   - Методы позволяют проверять лимиты сканирования, сохранять запросы и строить донатную статистику по сезонам.

6. CWL и бонусы
   - Коллекция cwl_seasons хранит агрегированные бонусы CWL (в виде списка или JSON).
   - Поддерживается получение бонусов за заданный месяц и расчет атак за сезон с разделением CWL/обычных войн.

7. Отслеживание построек
   - Коллекция building_trackers хранит настройки отслеживания улучшений зданий для профилей пользователей.
   - Коллекция building_snapshots сохраняет снапшоты состояния построек игроков.
   - Реализованы операции включения/выключения отслеживания, получения активных трекеров и сохранения/получения снапшотов.

Эта структура полностью заменяет прежние SQLite-таблицы и файловый JSON-слой и используется всеми сервисами бота.
