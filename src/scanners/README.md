# Scanners - Сканеры кланов и импортеры войн

Этот каталог содержит различные сканеры и импортеры для сбора данных о кланах и войнах Clash of Clans.

## Файлы в директории

### war_importer.py
**Импортер войн из топ-кланов**

Сканирует топ-кланы (до 10,000 на локацию) из 20 основных регионов и импортирует их войны в базу данных.

**Использование:**
```bash
python3 scanners/war_importer.py
```

**Когда использовать:**
- Когда нужен быстрый импорт из топ-кланов
- Для получения данных о наиболее активных кланах
- Когда время выполнения критично (1-2 часа)

**Подробнее:** См. `WAR_IMPORTER_README.md` в корневой директории

---

### clan_scanner.py
**Непрерывный сканер кланов**

Работает как фоновый сервис, непрерывно сканируя топ-кланы из различных локаций для отслеживания текущих войн.

**Использование:**
```python
from scanners.clan_scanner import ClanScanner
from database import DatabaseService
from coc_api import CocApiClient

db_service = DatabaseService()
coc_client = CocApiClient()
scanner = ClanScanner(db_service, coc_client)

await scanner.start()  # Запуск сканера
```

**Особенности:**
- Работает в фоновом режиме
- Интервал сканирования: 15 минут
- Кэширует отсканированные кланы (повторное сканирование через 1 час)
- Используется основным ботом для мониторинга войн

**Когда использовать:**
- Для непрерывного мониторинга войн
- Когда бот работает 24/7
- Для отслеживания текущих активных войн

---

## Альтернативы

Если вам нужен более полный импорт, используйте:

### all_importer.py
**Импортер ВСЕХ кланов (находится в корневой директории)**

Сканирует АБСОЛЮТНО ВСЕ доступные кланы из 200+ локаций без ограничений.

**Использование:**
```bash
python3 all_importer.py
```

**Когда использовать:**
- Когда нужны данные о максимальном количестве кланов
- Для полного сканирования всех регионов
- Когда время не критично (20-40 часов)

**Подробнее:** См. `ALL_IMPORTER_README.md` в корневой директории

---

## Сравнение сканеров

| Характеристика | clan_scanner | war_importer | all_importer |
|----------------|--------------|--------------|--------------|
| Тип | Фоновый сервис | Разовый импорт | Разовый импорт |
| Кланов на локацию | Топ-10 | До 10,000 | Все доступные |
| Количество локаций | 10 основных | 20 основных | 200+ всех |
| Время выполнения | Непрерывно | 1-2 часа | 20-40 часов |
| Интервал сканирования | 15 минут | Разово | Разово |
| Использование | В составе бота | Отдельно | Отдельно |
| Файл логов | Основной лог бота | war_importer.log | all_importer.log |

## Структура директории

```
scanners/
├── __init__.py           # Инициализация пакета
├── war_importer.py       # Импортер топ-кланов
└── clan_scanner.py       # Непрерывный сканер
```

## Импорты

Для использования сканеров из других частей проекта:

```python
# Импорт сканера кланов
from scanners.clan_scanner import ClanScanner

# Импорт импортера войн
from scanners.war_importer import WarImporter
```

## Примечания

- Все сканеры используют общие сервисы: `DatabaseService` и `CocApiClient`
- Все сканеры автоматически пропускают дублирующиеся войны
- Все сканеры логируют свою работу для отслеживания прогресса
- Для работы требуется токен API Clash of Clans
