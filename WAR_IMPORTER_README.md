# War Importer - Импортер данных войн

## Описание
War Importer - это отдельная программа для массового импорта данных о войнах из всех кланов в игре Clash of Clans. Программа запускается независимо от основного бота (main.py) и предназначена для единоразового использования.

## Возможности
- Импорт войн из топ-200 кланов каждой локации (Европа, Азия, Северная Америка и т.д.)
- Обработка всех завершенных войн из журнала войн каждого клана
- Автоматическое сохранение данных в базу данных
- Защита от дублирования - войны, которые уже есть в БД, пропускаются
- Детальное логирование всех операций
- Статистика по итогам импорта

## Требования
- Python 3.8+
- Установленные зависимости из requirements.txt
- Токен API Clash of Clans (получить на https://developer.clashofclans.com)

## Настройка

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка API токена
Создайте файл `api_tokens.txt` в корневой директории проекта со следующим содержимым:
```
COC_API_TOKEN=ваш_токен_api_clash_of_clans
```

Или установите переменную окружения:
```bash
export COC_API_TOKEN=ваш_токен_api_clash_of_clans
```

## Запуск

### Запуск программы
```bash
python3 war_importer.py
```

Программа начнет:
1. Инициализацию базы данных
2. Сканирование топ-кланов из всех локаций
3. Получение журнала войн каждого клана
4. Импорт всех завершенных войн в базу данных

### Логирование
Все операции логируются в:
- Консоль (stdout)
- Файл `war_importer.log`

## Особенности

### Без ограничений скорости
В отличие от обычного сканера кланов, war_importer НЕ ограничивает количество и скорость запросов к API. Это сделано специально для быстрого единоразового импорта больших объемов данных.

**ВНИМАНИЕ:** Используйте эту программу осторожно! Большое количество запросов к API может привести к временной блокировке вашего IP адреса.

### Обработанные локации
Программа обрабатывает следующие локации:
- Europe (32000007)
- North America (32000008)
- South America (32000009)
- Asia (32000010)
- Australia (32000011)
- Africa (32000012)
- Russia (32000185)
- China (32000038)
- India (32000113)
- Germany (32000094)
- United States (32000222)
- International (32000006)
- United Kingdom (32000061)
- Canada (32000023)
- France (32000032)
- Spain (32000166)
- Italy (32000107)
- Brazil (32000100)
- Japan (32000095)
- South Korea (32000138)

### Данные, которые импортируются
Для каждой войны сохраняются:
- Время окончания войны
- Название клана-противника
- Размер команды (teamSize)
- Количество звезд обеих команд
- Процент разрушения обеих команд
- Количество использованных атак
- Результат войны (win/lose/tie)

## Статистика
По завершении работы программа выведет:
- Время выполнения
- Количество проверенных кланов
- Количество импортированных войн
- Количество пропущенных войн (дубликаты)
- Количество ошибок

## Пример вывода
```
================================================================================
ЗАПУСК МАССОВОГО ИМПОРТА ВОЙН
================================================================================
Инициализация базы данных...
База данных инициализирована
Будет проверено локаций: 20
Начинается сканирование...
================================================================================

================================================================================
ИМПОРТ ПО ЛОКАЦИЯМ
================================================================================

Обработка локации 32000007...
Найдено 200 кланов в локации 32000007
  [1/200] Обработка клана: Example Clan (#ABC123)
    Найдено 10 войн в журнале
      ✓ Война импортирована: vs Enemy Clan (win) - 20231201T120000.000Z
...

================================================================================
ИМПОРТ ЗАВЕРШЕН
================================================================================
Время выполнения: 0:45:23
Всего кланов проверено: 4000
Уникальных кланов обработано: 3847
Войн импортировано: 12543
Войн пропущено (уже в БД): 234
Ошибок: 5
================================================================================
```

## Примечания
- Программа запускается единоразово, не является постоянным сервисом
- После завершения работы все импортированные данные доступны в базе данных
- Можно безопасно прервать программу с помощью Ctrl+C
- При повторном запуске войны, которые уже есть в БД, будут автоматически пропущены
